<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">
  <?ifndef ProductVersion ?>
    <?define ProductVersion = "0.1.0" ?>
  <?endif?>
  <?ifndef UpgradeCode ?>
    <?define UpgradeCode = "B8A2AE7B-41E3-4E64-9A5F-41E1D1D6C6F8" ?>
  <?endif?>

  <Product Id="*"
           Name="AymaraLang"
           Language="1033"
           Version="$(var.ProductVersion)"
           Manufacturer="AymaraLang Project"
           UpgradeCode="$(var.UpgradeCode)">
    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine" Platform="x64" />

    <MajorUpgrade DowngradeErrorMessage="Ya existe una versión más reciente de AymaraLang." />
    <MediaTemplate EmbedCab="yes" />

    <?if exists('$(sys.SOURCEFILEDIR)..\\..\\assets\\logo.ico') ?>
      <Icon Id="ProductIcon" SourceFile="$(sys.SOURCEFILEDIR)..\\..\\assets\\logo.ico" />
      <Property Id="ARPPRODUCTICON" Value="ProductIcon" />
    <?endif?>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

    <Feature Id="CoreFeature" Title="Core" Level="1" Absent="disallow">
      <ComponentGroupRef Id="CoreFiles" />
    </Feature>

    <Feature Id="LLVMFeature" Title="LLVM Backend" Level="2">
      <ComponentGroupRef Id="LLVMFiles" />
    </Feature>

    <Feature Id="PathFeature" Title="Add AymaraLang to PATH" Level="1">
      <ComponentRef Id="PathEnv" />
    </Feature>

    <UIRef Id="WixUI_FeatureTree" />
    <UIRef Id="WixUI_ErrorProgressText" />
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLDIR" Name="AymaraLang">
          <Directory Id="BINDIR" Name="bin" />
          <Directory Id="LLVMBACKENDDIR" Name="llvm-backend" />
        </Directory>
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <DirectoryRef Id="INSTALLDIR">
      <ComponentGroup Id="CoreFiles">
        <Files Include="$(var.DistDir)\\**\\*">
          <Exclude Files="$(var.DistDir)\\llvm-backend\\**\\*" />
        </Files>
      </ComponentGroup>

      <Component Id="PathEnv" Guid="*">
        <util:Environment Id="PathEnvVar"
                          Name="PATH"
                          Value="[INSTALLDIR]bin"
                          Part="last"
                          System="yes"
                          Action="set" />
      </Component>
    </DirectoryRef>
  </Fragment>

  <?if exists('$(var.DistDir)\\llvm-backend') ?>
  <Fragment>
    <DirectoryRef Id="LLVMBACKENDDIR">
      <ComponentGroup Id="LLVMFiles">
        <Files Include="$(var.DistDir)\\llvm-backend\\**\\*" />
      </ComponentGroup>
    </DirectoryRef>
  </Fragment>
  <?else?>
  <Fragment>
    <ComponentGroup Id="LLVMFiles" />
  </Fragment>
  <?endif?>
</Wix>
